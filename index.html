<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover" />
  <title>AgtronCam — Estimator Level Roasting</title>
  <meta name="description" content="Estimasi level roasting kopi (mirip skala Agtron) menggunakan kamera HP dengan kalibrasi sederhana. Offline, on-device." />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    html, body { height: 100%; }
    .badge { padding: 0.125rem 0.5rem; border-radius: 9999px; font-weight: 600; }
    .overlay-mask {
      position: absolute;
      inset: 0;
      pointer-events: none;
    }
    /* Soft grid overlay for alignment */
    .grid-bg {
      background-image:
      linear-gradient(to right, rgba(0,0,0,.06) 1px, transparent 1px),
      linear-gradient(to bottom, rgba(0,0,0,.06) 1px, transparent 1px);
      background-size: 24px 24px;
    }
    /* ROI guides */
    #roiCircle {
      position: absolute;
      border: 2px dashed rgba(255,255,255,.8);
      border-radius: 9999px;
      box-shadow: 0 0 0 9999px rgba(0,0,0,.45);
      pointer-events: none;
    }
    #roiWhite {
      position: absolute;
      border: 2px dashed rgba(255,255,255,.8);
      background: rgba(255,255,255,.05);
      box-shadow: 0 0 0 9999px rgba(0,0,0,.35);
      pointer-events: none;
    }
    .stat-label { color: #6b7280; }
    .mono { font-variant-numeric: tabular-nums; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
    .card {
      background: white;
      border-radius: 1rem;
      box-shadow: 0 10px 25px rgba(0,0,0,.07);
      border: 1px solid rgba(0,0,0,.05);
    }
    .btn {
      border-radius: .75rem;
      font-weight: 600;
      padding: .6rem .9rem;
      border: 1px solid rgba(0,0,0,.08);
      background: #111827;
      color: white;
      transition: transform .05s ease;
    }
    .btn:hover { filter: brightness(1.05); }
    .btn:active { transform: translateY(1px); }
    .btn-secondary {
      background: white; color: #111827;
    }
    .meter {
      height: .6rem; border-radius: .5rem; background: #e5e7eb; overflow: hidden;
    }
    .meter > div {
      height: 100%; width: 0%; background: #111827;
      transition: width .3s ease;
    }
    /* Mobile safe area */
    @supports (padding: env(safe-area-inset-bottom)) {
      .safe { padding-bottom: env(safe-area-inset-bottom); }
    }
  </style>
</head>
<body class="bg-gray-50 text-gray-900">
  <div class="max-w-6xl mx-auto p-4 sm:p-6 safe">
    <header class="flex items-center justify-between mb-4">
      <div class="flex items-center gap-3">
        <div class="h-10 w-10 rounded-2xl bg-black text-white grid place-items-center font-bold">A</div>
        <div>
          <h1 class="text-xl sm:text-2xl font-bold tracking-tight">AgtronCam</h1>
          <p class="text-sm text-gray-500 -mt-0.5">Estimator level roasting kopi (kamera HP + kalibrasi ringan)</p>
        </div>
      </div>
      <div class="text-xs sm:text-sm text-gray-500">v0.9 — on-device</div>
    </header>

    <main class="grid grid-cols-1 lg:grid-cols-2 gap-6">
      <!-- Camera Panel -->
      <section class="card p-4 sm:p-5 relative">
        <div class="flex items-center justify-between mb-3">
          <h2 class="font-semibold">Kamera & Area Sampel</h2>
          <div class="flex gap-2">
            <button id="btnStart" class="btn">Mulai Kamera</button>
            <button id="btnPause" class="btn btn-secondary">Jeda</button>
          </div>
        </div>

        <div class="relative rounded-xl overflow-hidden bg-black grid-bg">
          <video id="video" playsinline autoplay muted class="w-full h-[52vh] object-cover"></video>
          <canvas id="canvas" class="hidden"></canvas>
          <div id="roiCircle"></div>
          <div id="roiWhite"></div>
        </div>

        <div class="mt-4 grid grid-cols-2 sm:grid-cols-4 gap-2">
          <button id="btnCalib" class="btn btn-secondary">Kalibrasi Putih</button>
          <button id="btnMeasure" class="btn">Ukur</button>
          <button id="btnSave" class="btn btn-secondary">Simpan Kalibrasi</button>
          <button id="btnReset" class="btn btn-secondary">Reset</button>
        </div>

        <p class="text-xs text-gray-500 mt-3">
          Tip: Letakkan <b>kopi bubuk</b> rata pada piring kecil di tengah lingkaran. Sertakan selembar <b>kertas putih polos</b> di kotak atas-kanan untuk kalibrasi warna.
        </p>
      </section>

      <!-- Results Panel -->
      <section class="card p-4 sm:p-5">
        <h2 class="font-semibold mb-3">Hasil & Kualitas Pencahayaan</h2>
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
          <div class="p-3 rounded-lg bg-gray-50 border">
            <div class="text-sm stat-label">Agtron (estimasi)</div>
            <div class="text-3xl font-bold mono"><span id="agtron">--</span></div>
            <div class="mt-2 flex items-center gap-2">
              <span id="badge" class="badge bg-gray-200 text-gray-900">—</span>
              <span id="desc" class="text-sm text-gray-600"></span>
            </div>
            <div class="mt-3">
              <div class="meter"><div id="agtronBar"></div></div>
              <div class="flex justify-between text-xs text-gray-400 mt-1"><span>Very Dark</span><span>Very Light</span></div>
            </div>
          </div>

          <div class="p-3 rounded-lg bg-gray-50 border">
            <div class="text-sm stat-label">CIELAB</div>
            <div class="mono text-xl font-semibold"><span id="L">--</span> / <span id="a">--</span> / <span id="b">--</span></div>
            <div class="text-xs text-gray-500">L* (terang), a* (hijau→merah), b* (biru→kuning)</div>
          </div>

          <div class="p-3 rounded-lg bg-gray-50 border">
            <div class="text-sm stat-label">Skala & Offset (kalibrasi)</div>
            <div class="flex items-center gap-3 mt-1">
              <label class="text-xs w-16">Scale</label>
              <input id="scale" type="range" min="0.6" max="1.8" step="0.01" class="w-full" />
              <div class="mono w-14 text-right text-sm" id="scaleVal">1.20</div>
            </div>
            <div class="flex items-center gap-3 mt-2">
              <label class="text-xs w-16">Offset</label>
              <input id="offset" type="range" min="-20" max="30" step="0.5" class="w-full" />
              <div class="mono w-14 text-right text-sm" id="offsetVal">10.0</div>
            </div>
          </div>

          <div class="p-3 rounded-lg bg-gray-50 border">
            <div class="text-sm stat-label">Kualitas Pencahayaan</div>
            <div class="text-sm mt-1">
              <div>Glare (hotspot): <span id="glare" class="mono">--</span>%</div>
              <div>WB ΔRGB (putih): <span id="wbErr" class="mono">--</span></div>
              <div>Stabilitas (EMA): <span id="stability" class="mono">--</span></div>
            </div>
            <p id="qualityMsg" class="text-xs text-amber-600 mt-2">—</p>
          </div>
        </div>

        <div class="mt-4 text-xs text-gray-500 leading-relaxed">
          <b>Catatan:</b> Ini adalah estimator kamera. Untuk ketelitian profesional, gunakan alat Agtron/Lighttells. Hasil terbaik dengan pencahayaan konsisten (lampu putih 5000–6500K) dan kertas putih untuk kalibrasi.
        </div>
      </section>
    </main>

    <footer class="mt-6 text-center text-xs text-gray-400">
      © <span id="year"></span> AgtronCam. Dibangun untuk demo edukasi.
    </footer>
  </div>

  <script src="./app.js"></script>
  <script>
    document.getElementById('year').textContent = new Date().getFullYear();
  </script>
</body>
</html>
